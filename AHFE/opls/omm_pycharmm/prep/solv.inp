* CHARMM input file for Multi-Site lambda-dynamics
* generated by py_prep (JZV 02/2019) for ALF (RLH 01/2019)
* edited: Parveen Gartan, 27 June 2022
*
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!  Lambda Dynamics 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

set builddir = prep
set box = 26.5286831
set temp = 298.15
set lig = lig0
set resn = MOL

! perturbation variables
set nsites = 1 
set nsubs1 = 2 
set nblocks = 2 

bomblev -2

!! Read in toppar stream file
stream @builddir/toppar.str

read psf card name @builddir/@lig-solvated.psf
read coor card name @builddir/@lig-solvated.crd

coor stat sele all end

!! generate a dummy atom
!stream prep/dum_prep_1.str

!! Define MSLD substituent selections
!define site1_sub1 select resname @resn end
!define site1_sub2 select resname DUM end

!auto angle dihe  !! do not call after deleting sub-sub terms or loading in water
bomblev -1

!! Load solvent

!! Load ions

print coor sele .not. init end

bomblev 0

!! if using openMM
calc boxhalf = @box / 2
!set boxhalf = 0

crystal define cubic @box @box @box 90. 90. 90.
crystal build cutoff 14 nope 0
image byres xcen @boxhalf ycen @boxhalf zcen @boxhalf sele resn tip3 .or. resn pot .or. resn cla end
image byseg xcen @boxhalf ycen @boxhalf zcen @boxhalf sele .not. ( resn tip3 .or. resn pot .or. resn cla ) end

scalar charge stat sele all end

!! Copy main coords into comp set
cons harm clear
coor copy comp

set charge = ?cgtot

